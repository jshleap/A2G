#!/usr/bin/env python

from mpi4py import MPI
from itertools import zip_longest
from pyfaidx import Fasta
from A2G.align2consensus import *


def split_n_yield(fasta, chunks):
    fa = Fasta(fasta)
    chunks = [fa.items()] * chunks
    g = (list(filter(None, v)) for v in zip_longest(*chunks))
    for chunk in g:
        fasta_chunk = ['>%s/n%s' % (sq[1].long_name, sq[1]) for sq in chunk]
        yield '\n'.join(fasta_chunk)

    
comm = MPI.COMM_WORLD
size = comm.Get_size()
rank = comm.Get_rank()
